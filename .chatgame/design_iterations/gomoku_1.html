<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® äº”å­æ£‹å¯¹æˆ˜</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oxanium:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="gomoku_theme.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-sans) !important;
            background: hsl(var(--background)) !important;
            color: hsl(var(--foreground)) !important;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1, h2, h3 {
            font-family: var(--font-game) !important;
        }
        
        /* æ£‹ç›˜å®¹å™¨ */
        .board-container {
            background: hsl(var(--board-bg));
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-board), var(--shadow-xl);
            padding: 2rem;
            position: relative;
        }
        
        /* æ£‹ç›˜ç½‘æ ¼ */
        #gameBoard {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            grid-template-rows: repeat(15, 1fr);
            gap: 0;
            background: hsl(var(--board-bg));
            position: relative;
            aspect-ratio: 1;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* æ£‹ç›˜æ ¼å­ */
        .cell {
            border: 1px solid hsl(var(--board-line));
            position: relative;
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .cell:hover:not(.occupied) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* ç§»é™¤è¾¹ç¼˜è¾¹æ¡† */
        .cell:nth-child(-n+15) { border-top: none; }
        .cell:nth-child(15n) { border-right: none; }
        .cell:nth-child(n+211) { border-bottom: none; }
        .cell:nth-child(15n+1) { border-left: none; }
        
        /* å¤©å…ƒæ˜Ÿä½ */
        .star-point::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: hsl(var(--board-star));
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* æ£‹å­ */
        .stone {
            position: absolute;
            width: 85%;
            height: 85%;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: var(--shadow-stone);
            z-index: 10;
        }
        
        .stone.black {
            background: radial-gradient(circle at 30% 30%, hsl(var(--stone-black)), #000);
        }
        
        .stone.white {
            background: radial-gradient(circle at 30% 30%, hsl(var(--stone-white)), #e0e0e0);
        }
        
        /* è½å­åŠ¨ç”» */
        @keyframes dropStone {
            0% {
                opacity: 0;
                transform: translate(-50%, -150%) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .stone.dropping {
            animation: dropStone 400ms cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        /* æœ€åè½å­é«˜äº® */
        .stone.last-move::after {
            content: '';
            position: absolute;
            width: 30%;
            height: 30%;
            background: hsl(var(--highlight));
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* é¢„è§ˆæ£‹å­ */
        .preview-stone {
            position: absolute;
            width: 85%;
            height: 85%;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.4;
            pointer-events: none;
            transition: opacity var(--transition-fast);
        }
        
        .preview-stone.black {
            background: radial-gradient(circle at 30% 30%, hsl(var(--stone-black)), #000);
        }
        
        .preview-stone.white {
            background: radial-gradient(circle at 30% 30%, hsl(var(--stone-white)), #e0e0e0);
        }
        
        /* è·èƒœè¿çº¿ */
        .win-line {
            position: absolute;
            background: hsl(var(--win-line));
            height: 6px;
            border-radius: 3px;
            z-index: 20;
            box-shadow: 0 0 20px hsl(var(--win-line));
            animation: winLinePulse 1s ease-in-out 2;
        }
        
        @keyframes winLinePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        /* è·èƒœæ£‹å­åŠ¨ç”» */
        .stone.winning {
            animation: winningStone 600ms ease-in-out 3;
        }
        
        @keyframes winningStone {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            border: none;
            font-family: var(--font-sans);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn:active {
            transform: translateY(0) scale(0.95);
        }
        
        .btn-primary {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }
        
        .btn-secondary {
            background: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }
        
        .btn-destructive {
            background: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }
        
        .btn-accent {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }
        
        /* ç©å®¶æŒ‡ç¤ºå™¨ */
        .player-indicator {
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }
        
        .player-indicator.active {
            border-color: hsl(var(--primary));
            transform: scale(1.05);
            box-shadow: 0 0 20px hsla(var(--primary), 0.5);
        }
        
        /* æ¸¸æˆæ—¥å¿— */
        .log-entry {
            padding: var(--spacing-sm);
            border-left: 3px solid hsl(var(--muted));
            margin-bottom: var(--spacing-sm);
            animation: slideIn 200ms ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-base);
            backdrop-filter: blur(8px);
        }
        
        .modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: hsl(var(--card));
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-2xl);
            transform: scale(0.9);
            transition: transform var(--transition-base);
            text-align: center;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
            animation: modalBounce 600ms cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes modalBounce {
            0% { transform: scale(0.5); }
            60% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* äº”å½©çº¸å±‘ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            z-index: var(--z-modal);
            animation: confettiFall 3s linear forwards;
        }
        
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .board-container {
                padding: 1rem;
            }
            
            #gameBoard {
                max-width: 500px;
            }
        }
        
        @media (max-width: 768px) {
            #gameBoard {
                max-width: 400px;
            }
            
            .stone {
                width: 80%;
                height: 80%;
            }
        }
        
        /* å‡å°‘åŠ¨ç”»åå¥½ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Google AdSense æ¨ªå¹…å¹¿å‘Š -->
    <div class="w-full bg-gray-900 py-2">
        <div class="max-w-7xl mx-auto px-4">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3137049467355939"
                 data-ad-slot="4769400852"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- æ ‡é¢˜ -->
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-2 bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">
                ğŸ® äº”å­æ£‹å¯¹æˆ˜
            </h1>
            <p class="text-gray-400">ç»å…¸ç­–ç•¥æ¸¸æˆ Â· äº”å­è¿ç å³èƒœ</p>
        </header>

        <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- å·¦ä¾§é¢æ¿ -->
            <aside class="lg:col-span-3">
                <!-- ç©å®¶ä¿¡æ¯ -->
                <div class="card mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        ç©å®¶ä¿¡æ¯
                    </h2>
                    
                    <!-- é»‘æ–¹ -->
                    <div class="player-indicator mb-4 p-3 rounded-lg bg-gray-800" id="blackPlayer">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-gray-800 to-black border-2 border-gray-600"></div>
                            <div>
                                <div class="font-semibold">âš« é»‘æ–¹</div>
                                <div class="text-sm text-gray-400" id="blackStatus">å…ˆæ‰‹</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç™½æ–¹ -->
                    <div class="player-indicator p-3 rounded-lg bg-gray-800" id="whitePlayer">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-gray-100 to-white border-2 border-gray-300"></div>
                            <div>
                                <div class="font-semibold">âšª ç™½æ–¹</div>
                                <div class="text-sm text-gray-400" id="whiteStatus">ç­‰å¾…ä¸­...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¸¸æˆç»Ÿè®¡ -->
                <div class="card mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        æ¸¸æˆç»Ÿè®¡
                    </h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">å›åˆæ•°</span>
                            <span class="font-mono font-bold text-amber-400" id="moveCount">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">é»‘æ–¹èƒœ</span>
                            <span class="font-mono font-bold text-green-400" id="blackWins">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">ç™½æ–¹èƒœ</span>
                            <span class="font-mono font-bold text-green-400" id="whiteWins">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div class="card">
                    <div class="space-y-3">
                        <button class="btn btn-secondary w-full" id="undoBtn">
                            <i data-lucide="undo" class="w-4 h-4"></i>
                            æ‚”æ£‹
                        </button>
                        <button class="btn btn-destructive w-full" id="surrenderBtn">
                            <i data-lucide="flag" class="w-4 h-4"></i>
                            è®¤è¾“
                        </button>
                    </div>
                </div>
            </aside>

            <!-- ä¸­å¤®æ£‹ç›˜ -->
            <main class="lg:col-span-6">
                <div class="board-container">
                    <div id="gameBoard"></div>
                </div>
                
                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn btn-primary" id="restartBtn">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        é‡æ–°å¼€å§‹
                    </button>
                    <button class="btn btn-accent" id="hintBtn">
                        <i data-lucide="lightbulb" class="w-4 h-4"></i>
                        æç¤º
                    </button>
                </div>
            </main>

            <!-- å³ä¾§é¢æ¿ -->
            <aside class="lg:col-span-3">
                <!-- æ¸¸æˆæ—¥å¿— -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="scroll-text" class="w-5 h-5"></i>
                        æ¸¸æˆæ—¥å¿—
                    </h2>
                    <div id="gameLog" class="space-y-2 max-h-96 overflow-y-auto">
                        <div class="log-entry text-sm text-gray-400">
                            â€¢ æ¸¸æˆå¼€å§‹ï¼Œé»‘æ–¹å…ˆæ‰‹
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <div class="text-6xl mb-4" id="winnerEmoji">ğŸ†</div>
            <h2 class="text-3xl font-bold mb-2" id="winnerText">é»‘æ–¹è·èƒœï¼</h2>
            <p class="text-gray-400 mb-6" id="winnerMessage">æ­å–œé»‘æ–¹äº”å­è¿ç ï¼</p>
            <div class="flex gap-4 justify-center">
                <button class="btn btn-primary" id="playAgainBtn">
                    <i data-lucide="play" class="w-4 h-4"></i>
                    å†æ¥ä¸€å±€
                </button>
                <button class="btn btn-secondary" id="closeModalBtn">
                    <i data-lucide="x" class="w-4 h-4"></i>
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ– Lucide å›¾æ ‡
        lucide.createIcons();
        
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            board: Array(15).fill(null).map(() => Array(15).fill(null)),
            currentPlayer: 'black',
            moveHistory: [],
            gameOver: false,
            blackWins: 0,
            whiteWins: 0
        };
        
        // å¤©å…ƒæ˜Ÿä½åæ ‡ (15x15æ£‹ç›˜)
        const starPoints = [
            [3, 3], [3, 7], [3, 11],
            [7, 3], [7, 7], [7, 11],
            [11, 3], [11, 7], [11, 11]
        ];
        
        // åˆå§‹åŒ–æ£‹ç›˜
        function initBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    // æ·»åŠ å¤©å…ƒæ˜Ÿä½
                    if (starPoints.some(([r, c]) => r === i && c === j)) {
                        cell.classList.add('star-point');
                    }
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('mouseenter', handleCellHover);
                    cell.addEventListener('mouseleave', handleCellLeave);
                    
                    board.appendChild(cell);
                }
            }
        }
        
        // å¤„ç†æ ¼å­ç‚¹å‡»
        function handleCellClick(e) {
            if (gameState.gameOver) return;
            
            const cell = e.currentTarget;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            if (gameState.board[row][col]) return;
            
            placeStone(row, col);
        }
        
        // æ”¾ç½®æ£‹å­
        function placeStone(row, col) {
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            
            // ç§»é™¤ä¹‹å‰çš„æœ€åè½å­æ ‡è®°
            document.querySelectorAll('.stone.last-move').forEach(s => s.classList.remove('last-move'));
            
            // åˆ›å»ºæ£‹å­
            const stone = document.createElement('div');
            stone.className = `stone ${gameState.currentPlayer} dropping last-move`;
            cell.appendChild(stone);
            cell.classList.add('occupied');
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.board[row][col] = gameState.currentPlayer;
            gameState.moveHistory.push({ row, col, player: gameState.currentPlayer });
            
            // æ·»åŠ æ—¥å¿—
            addLog(`${gameState.currentPlayer === 'black' ? 'âš« é»‘æ–¹' : 'âšª ç™½æ–¹'} è½å­äº (${row + 1}, ${col + 1})`);
            
            // æ£€æŸ¥èƒœåˆ©
            if (checkWin(row, col)) {
                handleWin(row, col);
                return;
            }
            
            // åˆ‡æ¢ç©å®¶
            switchPlayer();
            updateUI();
        }
        
        // æ£€æŸ¥èƒœåˆ©
        function checkWin(row, col) {
            const player = gameState.board[row][col];
            const directions = [
                [[0, 1], [0, -1]],   // æ¨ªå‘
                [[1, 0], [-1, 0]],   // çºµå‘
                [[1, 1], [-1, -1]],  // ä¸»å¯¹è§’çº¿
                [[1, -1], [-1, 1]]   // å‰¯å¯¹è§’çº¿
            ];
            
            for (const [dir1, dir2] of directions) {
                let count = 1;
                const winningStones = [[row, col]];
                
                // æ£€æŸ¥ä¸¤ä¸ªæ–¹å‘
                for (const [dr, dc] of [dir1, dir2]) {
                    let r = row + dr;
                    let c = col + dc;
                    
                    while (r >= 0 && r < 15 && c >= 0 && c < 15 && gameState.board[r][c] === player) {
                        count++;
                        winningStones.push([r, c]);
                        r += dr;
                        c += dc;
                    }
                }
                
                if (count >= 5) {
                    highlightWinningStones(winningStones);
                    return true;
                }
            }
            
            return false;
        }
        
        // é«˜äº®è·èƒœæ£‹å­
        function highlightWinningStones(stones) {
            stones.forEach(([row, col]) => {
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                const stone = cell.querySelector('.stone');
                if (stone) {
                    stone.classList.add('winning');
                }
            });
        }
        
        // å¤„ç†èƒœåˆ©
        function handleWin(row, col) {
            gameState.gameOver = true;
            const winner = gameState.currentPlayer;
            
            if (winner === 'black') {
                gameState.blackWins++;
            } else {
                gameState.whiteWins++;
            }
            
            addLog(`ğŸ† ${winner === 'black' ? 'âš« é»‘æ–¹' : 'âšª ç™½æ–¹'} è·èƒœï¼`);
            updateUI();
            
            // æ˜¾ç¤ºèƒœåˆ©æ¨¡æ€æ¡†
            setTimeout(() => {
                showGameOverModal(winner);
                createConfetti();
            }, 1000);
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¨¡æ€æ¡†
        function showGameOverModal(winner) {
            const modal = document.getElementById('gameOverModal');
            const emoji = document.getElementById('winnerEmoji');
            const text = document.getElementById('winnerText');
            const message = document.getElementById('winnerMessage');
            
            emoji.textContent = winner === 'black' ? 'âš«' : 'âšª';
            text.textContent = `${winner === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'}è·èƒœï¼`;
            message.textContent = `æ­å–œ${winner === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'}äº”å­è¿ç ï¼`;
            
            modal.classList.add('show');
        }
        
        // åˆ›å»ºäº”å½©çº¸å±‘
        function createConfetti() {
            const colors = ['#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ef4444'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }
        
        // åˆ‡æ¢ç©å®¶
        function switchPlayer() {
            gameState.currentPlayer = gameState.currentPlayer === 'black' ? 'white' : 'black';
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°ç©å®¶æŒ‡ç¤ºå™¨
            const blackPlayer = document.getElementById('blackPlayer');
            const whitePlayer = document.getElementById('whitePlayer');
            const blackStatus = document.getElementById('blackStatus');
            const whiteStatus = document.getElementById('whiteStatus');
            
            if (gameState.currentPlayer === 'black') {
                blackPlayer.classList.add('active');
                whitePlayer.classList.remove('active');
                blackStatus.textContent = 'å½“å‰å›åˆ';
                whiteStatus.textContent = 'ç­‰å¾…ä¸­...';
            } else {
                whitePlayer.classList.add('active');
                blackPlayer.classList.remove('active');
                whiteStatus.textContent = 'å½“å‰å›åˆ';
                blackStatus.textContent = 'ç­‰å¾…ä¸­...';
            }
            
            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('moveCount').textContent = gameState.moveHistory.length;
            document.getElementById('blackWins').textContent = gameState.blackWins;
            document.getElementById('whiteWins').textContent = gameState.whiteWins;
        }
        
        // å¤„ç†æ ¼å­æ‚¬åœ
        function handleCellHover(e) {
            if (gameState.gameOver) return;
            
            const cell = e.currentTarget;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            if (gameState.board[row][col]) return;
            
            const preview = document.createElement('div');
            preview.className = `preview-stone ${gameState.currentPlayer}`;
            preview.id = 'preview';
            cell.appendChild(preview);
        }
        
        // å¤„ç†æ ¼å­ç¦»å¼€
        function handleCellLeave(e) {
            const preview = document.getElementById('preview');
            if (preview) preview.remove();
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry text-sm text-gray-400';
            entry.textContent = `â€¢ ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            gameState.board = Array(15).fill(null).map(() => Array(15).fill(null));
            gameState.currentPlayer = 'black';
            gameState.moveHistory = [];
            gameState.gameOver = false;
            
            initBoard();
            updateUI();
            
            document.getElementById('gameLog').innerHTML = '<div class="log-entry text-sm text-gray-400">â€¢ æ¸¸æˆå¼€å§‹ï¼Œé»‘æ–¹å…ˆæ‰‹</div>';
            document.getElementById('gameOverModal').classList.remove('show');
        }
        
        // æ‚”æ£‹
        function undoMove() {
            if (gameState.moveHistory.length === 0 || gameState.gameOver) return;
            
            const lastMove = gameState.moveHistory.pop();
            const cell = document.querySelector(`[data-row="${lastMove.row}"][data-col="${lastMove.col}"]`);
            const stone = cell.querySelector('.stone');
            
            if (stone) {
                stone.style.animation = 'none';
                stone.style.transform = 'translate(-50%, -50%) scale(0.5)';
                stone.style.opacity = '0';
                setTimeout(() => {
                    stone.remove();
                    cell.classList.remove('occupied');
                }, 250);
            }
            
            gameState.board[lastMove.row][lastMove.col] = null;
            switchPlayer();
            updateUI();
            
            addLog('æ’¤é”€äº†ä¸Šä¸€æ­¥æ“ä½œ');
        }
        
        // è®¤è¾“
        function surrender() {
            if (gameState.gameOver) return;
            
            const winner = gameState.currentPlayer === 'black' ? 'white' : 'black';
            gameState.gameOver = true;
            
            if (winner === 'black') {
                gameState.blackWins++;
            } else {
                gameState.whiteWins++;
            }
            
            addLog(`${gameState.currentPlayer === 'black' ? 'âš« é»‘æ–¹' : 'âšª ç™½æ–¹'} è®¤è¾“`);
            updateUI();
            
            setTimeout(() => {
                showGameOverModal(winner);
            }, 500);
        }
        
        // æç¤º
        function showHint() {
            if (gameState.gameOver) return;
            
            // ç®€å•çš„æç¤ºï¼šæ‰¾åˆ°ä¸€ä¸ªç©ºä½
            for (let i = 0; i < 15; i++) {
                for (let j = 0; j < 15; j++) {
                    if (!gameState.board[i][j]) {
                        const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                        cell.style.background = 'rgba(16, 185, 129, 0.3)';
                        
                        setTimeout(() => {
                            cell.style.background = '';
                        }, 1500);
                        
                        addLog(`ğŸ’¡ å»ºè®®è½å­ä½ç½®: (${i + 1}, ${j + 1})`);
                        return;
                    }
                }
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('restartBtn').addEventListener('click', restartGame);
        document.getElementById('undoBtn').addEventListener('click', undoMove);
        document.getElementById('surrenderBtn').addEventListener('click', surrender);
        document.getElementById('hintBtn').addEventListener('click', showHint);
        document.getElementById('playAgainBtn').addEventListener('click', restartGame);
        document.getElementById('closeModalBtn').addEventListener('click', () => {
            document.getElementById('gameOverModal').classList.remove('show');
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initBoard();
        updateUI();
        
        // åŠ è½½ Google AdSense
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</body>
</html>