<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ÁªèÂÖ∏2048Ê∏∏Êàè - ÁßªÂä®ËÆæÂ§á‰ºòÂÖàËÆæËÆ°">
    <title>2048 Ê∏∏Êàè</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- Theme CSS -->
    <link rel="stylesheet" href="2048_theme.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: var(--font-sans) !important;
            background: var(--background) !important;
            color: var(--foreground) !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-md);
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }
        
        /* Â§¥ÈÉ® */
        .header {
            text-align: center;
            padding: var(--spacing-md) 0;
        }
        
        .header h1 {
            font-size: 3.5rem !important;
            font-weight: 700 !important;
            color: var(--primary) !important;
            font-family: var(--font-sans) !important;
            margin-bottom: var(--spacing-sm);
            text-shadow: 2px 2px 4px rgba(119, 110, 101, 0.1);
        }
        
        .header p {
            font-size: 0.9rem;
            color: var(--muted-foreground);
            font-weight: 400;
        }
        
        /* ÂàÜÊï∞Èù¢Êùø */
        .score-panel {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }
        
        .score-box {
            background: var(--muted);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            text-align: center;
            min-width: 120px;
            box-shadow: var(--shadow-sm);
        }
        
        .score-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--primary-foreground);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            letter-spacing: 0.5px;
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-foreground);
            font-family: var(--font-mono);
        }
        
        .score-add {
            position: absolute;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
            animation: scoreFloat 600ms ease-out forwards;
            pointer-events: none;
            font-family: var(--font-mono);
        }
        
        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
        
        /* Ê∏∏ÊàèÁΩëÊ†º */
        .game-board {
            background: var(--muted);
            border-radius: var(--radius-lg);
            padding: var(--grid-gap);
            box-shadow: var(--shadow-lg);
            position: relative;
            touch-action: none;
            user-select: none;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--grid-gap);
            position: relative;
        }
        
        .grid-cell {
            aspect-ratio: 1;
            background: var(--input);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-inner);
        }
        
        .tile-container {
            position: absolute;
            top: var(--grid-gap);
            left: var(--grid-gap);
            width: calc(100% - var(--grid-gap) * 2);
            height: calc(100% - var(--grid-gap) * 2);
            pointer-events: none;
        }
        
        .tile {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-weight: 700;
            border-radius: var(--radius-md);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            box-shadow: var(--shadow-tile);
            will-change: transform;
        }
        
        .tile-new {
            animation: tileAppear 200ms cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .tile-merge {
            animation: tileMerge 200ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes tileAppear {
            0% {
                opacity: 0;
                transform: scale(0);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes tileMerge {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        /* ÊñπÂùóÈ¢úËâ≤ */
        .tile-2 { background: var(--tile-2); color: var(--tile-2-fg); font-size: 2rem; }
        .tile-4 { background: var(--tile-4); color: var(--tile-4-fg); font-size: 2rem; }
        .tile-8 { background: var(--tile-8); color: var(--tile-8-fg); font-size: 2rem; }
        .tile-16 { background: var(--tile-16); color: var(--tile-16-fg); font-size: 1.8rem; }
        .tile-32 { background: var(--tile-32); color: var(--tile-32-fg); font-size: 1.8rem; }
        .tile-64 { background: var(--tile-64); color: var(--tile-64-fg); font-size: 1.8rem; }
        .tile-128 { background: var(--tile-128); color: var(--tile-128-fg); font-size: 1.5rem; }
        .tile-256 { background: var(--tile-256); color: var(--tile-256-fg); font-size: 1.5rem; }
        .tile-512 { background: var(--tile-512); color: var(--tile-512-fg); font-size: 1.5rem; }
        .tile-1024 { background: var(--tile-1024); color: var(--tile-1024-fg); font-size: 1.2rem; }
        .tile-2048 { background: var(--tile-2048); color: var(--tile-2048-fg); font-size: 1.2rem; }
        .tile-super { background: var(--tile-super); color: var(--tile-super-fg); font-size: 1rem; }
        
        /* Êñ∞Ê∏∏ÊàèÊåâÈíÆ */
        .new-game-btn {
            background: var(--primary);
            color: var(--primary-foreground);
            border: none;
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-sans);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .new-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .new-game-btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }
        
        /* Ê∏∏ÊàèËØ¥Êòé */
        .instructions {
            background: var(--card);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            text-align: center;
        }
        
        .instructions p {
            font-size: 0.9rem;
            color: var(--card-foreground);
            line-height: 1.6;
            margin-bottom: var(--spacing-xs);
        }
        
        .instructions strong {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Ê∏∏ÊàèÁªìÊùüÈÅÆÁΩ© */
        .game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(119, 110, 101, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 300ms ease-out;
            backdrop-filter: blur(4px);
        }
        
        .game-over-overlay.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .game-over-modal {
            background: var(--card);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-2xl);
            text-align: center;
            max-width: 90%;
            animation: slideDown 300ms ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .game-over-modal h2 {
            font-size: 2rem !important;
            color: var(--primary) !important;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-sans) !important;
        }
        
        .game-over-modal p {
            font-size: 1.1rem;
            color: var(--card-foreground);
            margin-bottom: var(--spacing-lg);
        }
        
        .game-over-modal .final-score {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            font-family: var(--font-mono);
            margin: var(--spacing-lg) 0;
        }
        
        /* ÂπøÂëäÂå∫Âüü */
        .ad-container {
            margin-top: var(--spacing-lg);
            text-align: center;
            min-height: 90px;
            background: var(--card);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }
        
        /* ÂìçÂ∫îÂºè */
        @media (min-width: 768px) {
            .header h1 {
                font-size: 4.5rem !important;
            }
            
            .tile-2, .tile-4, .tile-8 { font-size: 2.5rem; }
            .tile-16, .tile-32, .tile-64 { font-size: 2.2rem; }
            .tile-128, .tile-256, .tile-512 { font-size: 1.8rem; }
            .tile-1024, .tile-2048 { font-size: 1.5rem; }
        }
        
        @media (max-width: 380px) {
            .header h1 {
                font-size: 2.5rem !important;
            }
            
            .score-box {
                min-width: 100px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
            
            .tile-2, .tile-4, .tile-8 { font-size: 1.5rem; }
            .tile-16, .tile-32, .tile-64 { font-size: 1.3rem; }
            .tile-128, .tile-256, .tile-512 { font-size: 1.1rem; }
            .tile-1024, .tile-2048 { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Â§¥ÈÉ® -->
        <div class="header">
            <h1>2048</h1>
            <p>ÂêàÂπ∂ÊñπÂùóÔºåËææÂà∞2048ÔºÅ</p>
        </div>
        
        <!-- ÂàÜÊï∞Èù¢Êùø -->
        <div class="score-panel">
            <div class="score-box">
                <div class="score-label">ÂàÜÊï∞</div>
                <div class="score-value" id="current-score">0</div>
            </div>
            <div class="score-box">
                <div class="score-label">ÊúÄÈ´òÂàÜ</div>
                <div class="score-value" id="best-score">0</div>
            </div>
        </div>
        
        <!-- Êñ∞Ê∏∏ÊàèÊåâÈíÆ -->
        <button class="new-game-btn" id="new-game-btn">
            <i data-lucide="refresh-cw"></i>
            Êñ∞Ê∏∏Êàè
        </button>
        
        <!-- Ê∏∏ÊàèÈù¢Êùø -->
        <div class="game-board" id="game-board">
            <div class="grid-container">
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
                <div class="grid-cell"></div>
            </div>
            <div class="tile-container" id="tile-container"></div>
        </div>
        
        <!-- Ê∏∏ÊàèËØ¥Êòé -->
        <div class="instructions">
            <p><strong>üí° Â¶Ç‰ΩïÊ∏∏ÊàèÔºö</strong></p>
            <p>Âú®ÁßªÂä®ËÆæÂ§á‰∏ä<strong>ÊªëÂä®</strong>ÔºåÂú®ÁîµËÑë‰∏ä‰ΩøÁî®<strong>ÊñπÂêëÈîÆ</strong></p>
            <p>ÂêàÂπ∂Áõ∏ÂêåÊï∞Â≠óÁöÑÊñπÂùóÔºåËææÂà∞ <strong>2048</strong>ÔºÅ</p>
        </div>
        
        <!-- ÂπøÂëäÂå∫Âüü -->
        <div class="ad-container">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3137049467355939"
                crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-3137049467355939"
                data-ad-slot="4769400852"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    
    <!-- Ê∏∏ÊàèÁªìÊùüÈÅÆÁΩ© -->
    <div class="game-over-overlay" id="game-over-overlay">
        <div class="game-over-modal">
            <h2 id="game-over-title">Ê∏∏ÊàèÁªìÊùüÔºÅ</h2>
            <p id="game-over-message">Ê≤°ÊúâÊõ¥Â§öÁßªÂä®‰∫Ü</p>
            <div class="final-score" id="final-score">0</div>
            <button class="new-game-btn" onclick="game.restart()">
                <i data-lucide="refresh-cw"></i>
                ÂÜçÊù•‰∏ÄÂ±Ä
            </button>
        </div>
    </div>
    
    <script>
        // ÂàùÂßãÂåñ Lucide ÂõæÊ†á
        lucide.createIcons();
        
        // 2048 Ê∏∏ÊàèÈÄªËæë
        class Game2048 {
            constructor() {
                this.gridSize = 4;
                this.grid = [];
                this.score = 0;
                this.bestScore = parseInt(localStorage.getItem('bestScore')) || 0;
                this.gameOver = false;
                this.won = false;
                this.moving = false;
                
                this.tileContainer = document.getElementById('tile-container');
                this.gameBoard = document.getElementById('game-board');
                this.currentScoreEl = document.getElementById('current-score');
                this.bestScoreEl = document.getElementById('best-score');
                this.gameOverOverlay = document.getElementById('game-over-overlay');
                
                this.init();
            }
            
            init() {
                this.grid = Array(this.gridSize).fill(null).map(() => Array(this.gridSize).fill(0));
                this.score = 0;
                this.gameOver = false;
                this.won = false;
                this.updateScore();
                this.addRandomTile();
                this.addRandomTile();
                this.render();
                this.setupControls();
            }
            
            setupControls() {
                // ÈîÆÁõòÊéßÂà∂
                document.addEventListener('keydown', (e) => {
                    if (this.moving || this.gameOver) return;
                    
                    const keyMap = {
                        'ArrowUp': 'up',
                        'ArrowDown': 'down',
                        'ArrowLeft': 'left',
                        'ArrowRight': 'right'
                    };
                    
                    if (keyMap[e.key]) {
                        e.preventDefault();
                        this.move(keyMap[e.key]);
                    }
                });
                
                // Ëß¶Êë∏ÊéßÂà∂
                let touchStartX = 0;
                let touchStartY = 0;
                let touchEndX = 0;
                let touchEndY = 0;
                
                this.gameBoard.addEventListener('touchstart', (e) => {
                    touchStartX = e.changedTouches[0].screenX;
                    touchStartY = e.changedTouches[0].screenY;
                }, { passive: true });
                
                this.gameBoard.addEventListener('touchend', (e) => {
                    if (this.moving || this.gameOver) return;
                    
                    touchEndX = e.changedTouches[0].screenX;
                    touchEndY = e.changedTouches[0].screenY;
                    this.handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
                }, { passive: true });
                
                // Êñ∞Ê∏∏ÊàèÊåâÈíÆ
                document.getElementById('new-game-btn').addEventListener('click', () => {
                    this.restart();
                });
            }
            
            handleSwipe(startX, startY, endX, endY) {
                const diffX = endX - startX;
                const diffY = endY - startY;
                const threshold = 30;
                
                if (Math.abs(diffX) < threshold && Math.abs(diffY) < threshold) return;
                
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    // Ê∞¥Âπ≥ÊªëÂä®
                    this.move(diffX > 0 ? 'right' : 'left');
                } else {
                    // ÂûÇÁõ¥ÊªëÂä®
                    this.move(diffY > 0 ? 'down' : 'up');
                }
            }
            
            move(direction) {
                this.moving = true;
                let moved = false;
                const oldGrid = JSON.parse(JSON.stringify(this.grid));
                
                switch(direction) {
                    case 'left':
                        moved = this.moveLeft();
                        break;
                    case 'right':
                        moved = this.moveRight();
                        break;
                    case 'up':
                        moved = this.moveUp();
                        break;
                    case 'down':
                        moved = this.moveDown();
                        break;
                }
                
                if (moved) {
                    setTimeout(() => {
                        this.addRandomTile();
                        this.render();
                        this.checkGameState();
                        this.moving = false;
                    }, 150);
                } else {
                    this.moving = false;
                }
            }
            
            moveLeft() {
                let moved = false;
                for (let i = 0; i < this.gridSize; i++) {
                    const row = this.grid[i].filter(val => val !== 0);
                    const merged = [];
                    
                    for (let j = 0; j < row.length; j++) {
                        if (j < row.length - 1 && row[j] === row[j + 1]) {
                            merged.push(row[j] * 2);
                            this.score += row[j] * 2;
                            j++;
                        } else {
                            merged.push(row[j]);
                        }
                    }
                    
                    while (merged.length < this.gridSize) {
                        merged.push(0);
                    }
                    
                    if (JSON.stringify(this.grid[i]) !== JSON.stringify(merged)) {
                        moved = true;
                    }
                    this.grid[i] = merged;
                }
                
                if (moved) this.updateScore();
                return moved;
            }
            
            moveRight() {
                this.reverseGrid();
                const moved = this.moveLeft();
                this.reverseGrid();
                return moved;
            }
            
            moveUp() {
                this.transposeGrid();
                const moved = this.moveLeft();
                this.transposeGrid();
                return moved;
            }
            
            moveDown() {
                this.transposeGrid();
                this.reverseGrid();
                const moved = this.moveLeft();
                this.reverseGrid();
                this.transposeGrid();
                return moved;
            }
            
            reverseGrid() {
                this.grid = this.grid.map(row => row.reverse());
            }
            
            transposeGrid() {
                this.grid = this.grid[0].map((_, i) => this.grid.map(row => row[i]));
            }
            
            addRandomTile() {
                const emptyCells = [];
                for (let i = 0; i < this.gridSize; i++) {
                    for (let j = 0; j < this.gridSize; j++) {
                        if (this.grid[i][j] === 0) {
                            emptyCells.push({row: i, col: j});
                        }
                    }
                }
                
                if (emptyCells.length > 0) {
                    const {row, col} = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    this.grid[row][col] = Math.random() < 0.9 ? 2 : 4;
                }
            }
            
            render() {
                this.tileContainer.innerHTML = '';
                const cellSize = this.gameBoard.querySelector('.grid-cell').offsetWidth;
                const gap = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--grid-gap'));
                
                for (let i = 0; i < this.gridSize; i++) {
                    for (let j = 0; j < this.gridSize; j++) {
                        const value = this.grid[i][j];
                        if (value !== 0) {
                            const tile = document.createElement('div');
                            tile.className = `tile tile-${value} tile-new`;
                            tile.textContent = value;
                            tile.style.width = cellSize + 'px';
                            tile.style.height = cellSize + 'px';
                            tile.style.left = (j * (cellSize + gap)) + 'px';
                            tile.style.top = (i * (cellSize + gap)) + 'px';
                            
                            if (value > 2048) {
                                tile.classList.add('tile-super');
                            }
                            
                            this.tileContainer.appendChild(tile);
                        }
                    }
                }
                
                // ÈáçÊñ∞ÂàùÂßãÂåñÂõæÊ†á
                lucide.createIcons();
            }
            
            updateScore() {
                this.currentScoreEl.textContent = this.score;
                
                if (this.score > this.bestScore) {
                    this.bestScore = this.score;
                    localStorage.setItem('bestScore', this.bestScore);
                }
                this.bestScoreEl.textContent = this.bestScore;
            }
            
            checkGameState() {
                // Ê£ÄÊü•ÊòØÂê¶Ëé∑ËÉú
                if (!this.won) {
                    for (let i = 0; i < this.gridSize; i++) {
                        for (let j = 0; j < this.gridSize; j++) {
                            if (this.grid[i][j] === 2048) {
                                this.won = true;
                                this.showGameOver('ÊÅ≠Âñú‰Ω†Ëµ¢‰∫ÜÔºÅ', '‰Ω†ËææÂà∞‰∫Ü2048ÔºÅ');
                                return;
                            }
                        }
                    }
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÁ©∫Ê†º
                for (let i = 0; i < this.gridSize; i++) {
                    for (let j = 0; j < this.gridSize; j++) {
                        if (this.grid[i][j] === 0) return;
                    }
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ËøòËÉΩÂêàÂπ∂
                for (let i = 0; i < this.gridSize; i++) {
                    for (let j = 0; j < this.gridSize; j++) {
                        const current = this.grid[i][j];
                        if (
                            (j < this.gridSize - 1 && current === this.grid[i][j + 1]) ||
                            (i < this.gridSize - 1 && current === this.grid[i + 1][j])
                        ) {
                            return;
                        }
                    }
                }
                
                // Ê∏∏ÊàèÁªìÊùü
                this.gameOver = true;
                this.showGameOver('Ê∏∏ÊàèÁªìÊùüÔºÅ', 'Ê≤°ÊúâÊõ¥Â§öÁßªÂä®‰∫Ü');
            }
            
            showGameOver(title, message) {
                document.getElementById('game-over-title').textContent = title;
                document.getElementById('game-over-message').textContent = message;
                document.getElementById('final-score').textContent = this.score;
                this.gameOverOverlay.classList.add('show');
                
                // ÈáçÊñ∞ÂàùÂßãÂåñÂõæÊ†á
                setTimeout(() => lucide.createIcons(), 100);
            }
            
            restart() {
                this.gameOverOverlay.classList.remove('show');
                this.tileContainer.innerHTML = '';
                this.init();
            }
        }
        
        // ÂêØÂä®Ê∏∏Êàè
        const game = new Game2048();
    </script>
</body>
</html>